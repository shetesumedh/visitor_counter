{"ast":null,"code":"import { standardErrors } from '../core/error/errors.js';\nimport { logSnackbarActionClicked, logSnackbarShown } from '../core/telemetry/events/snackbar.js';\nimport { RETRY_SVG_PATH } from '../sign/walletlink/relay/ui/WalletLinkRelayUI.js';\nimport { Snackbar } from '../sign/walletlink/relay/ui/components/Snackbar/Snackbar.js';\nimport { NAME, VERSION } from '../sdk-info.js';\nimport { getCrossOriginOpenerPolicy } from './checkCrossOriginOpenerPolicy.js';\nconst POPUP_WIDTH = 420;\nconst POPUP_HEIGHT = 700;\nconst RETRY_BUTTON = {\n  isRed: false,\n  info: 'Retry',\n  svgWidth: '10',\n  svgHeight: '11',\n  path: RETRY_SVG_PATH,\n  defaultFillRule: 'evenodd',\n  defaultClipRule: 'evenodd'\n};\nconst POPUP_BLOCKED_MESSAGE = 'Popup was blocked. Try again.';\nlet snackbar = null;\nexport function openPopup(url) {\n  const left = (window.innerWidth - POPUP_WIDTH) / 2 + window.screenX;\n  const top = (window.innerHeight - POPUP_HEIGHT) / 2 + window.screenY;\n  appendAppInfoQueryParams(url);\n  function tryOpenPopup() {\n    const popupId = `wallet_${crypto.randomUUID()}`;\n    const popup = window.open(url, popupId, `width=${POPUP_WIDTH}, height=${POPUP_HEIGHT}, left=${left}, top=${top}`);\n    popup === null || popup === void 0 ? void 0 : popup.focus();\n    if (!popup) {\n      return null;\n    }\n    return popup;\n  }\n  let popup = tryOpenPopup();\n  // If the popup was blocked, show a snackbar with a retry button\n  if (!popup) {\n    const sb = initSnackbar();\n    return new Promise((resolve, reject) => {\n      logSnackbarShown({\n        snackbarContext: 'popup_blocked'\n      });\n      sb.presentItem({\n        autoExpand: true,\n        message: POPUP_BLOCKED_MESSAGE,\n        menuItems: [Object.assign(Object.assign({}, RETRY_BUTTON), {\n          onClick: () => {\n            logSnackbarActionClicked({\n              snackbarContext: 'popup_blocked',\n              snackbarAction: 'confirm'\n            });\n            popup = tryOpenPopup();\n            if (popup) {\n              resolve(popup);\n            } else {\n              reject(standardErrors.rpc.internal('Popup window was blocked'));\n            }\n            sb.clear();\n          }\n        })]\n      });\n    });\n  }\n  return Promise.resolve(popup);\n}\nexport function closePopup(popup) {\n  if (popup && !popup.closed) {\n    popup.close();\n  }\n}\nfunction appendAppInfoQueryParams(url) {\n  const params = {\n    sdkName: NAME,\n    sdkVersion: VERSION,\n    origin: window.location.origin,\n    coop: getCrossOriginOpenerPolicy()\n  };\n  for (const [key, value] of Object.entries(params)) {\n    if (!url.searchParams.has(key)) {\n      url.searchParams.append(key, value.toString());\n    }\n  }\n}\nexport function initSnackbar() {\n  if (!snackbar) {\n    const root = document.createElement('div');\n    root.className = '-cbwsdk-css-reset';\n    document.body.appendChild(root);\n    snackbar = new Snackbar();\n    snackbar.attach(root);\n  }\n  return snackbar;\n}","map":{"version":3,"names":["standardErrors","logSnackbarActionClicked","logSnackbarShown","RETRY_SVG_PATH","Snackbar","NAME","VERSION","getCrossOriginOpenerPolicy","POPUP_WIDTH","POPUP_HEIGHT","RETRY_BUTTON","isRed","info","svgWidth","svgHeight","path","defaultFillRule","defaultClipRule","POPUP_BLOCKED_MESSAGE","snackbar","openPopup","url","left","window","innerWidth","screenX","top","innerHeight","screenY","appendAppInfoQueryParams","tryOpenPopup","popupId","crypto","randomUUID","popup","open","focus","sb","initSnackbar","Promise","resolve","reject","snackbarContext","presentItem","autoExpand","message","menuItems","onClick","snackbarAction","rpc","internal","clear","closePopup","closed","close","params","sdkName","sdkVersion","origin","location","coop","key","value","Object","entries","searchParams","has","append","toString","root","document","createElement","className","body","appendChild","attach"],"sources":["../../src/util/web.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}