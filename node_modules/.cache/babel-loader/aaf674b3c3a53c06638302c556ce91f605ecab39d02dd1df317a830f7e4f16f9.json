{"ast":null,"code":"import { ScopedLocalStorage } from '../core/storage/ScopedLocalStorage.js';\nimport { SCWSigner } from './scw/SCWSigner.js';\nimport { WalletLinkSigner } from './walletlink/WalletLinkSigner.js';\nconst SIGNER_TYPE_KEY = 'SignerType';\nconst storage = new ScopedLocalStorage('CBWSDK', 'SignerConfigurator');\nexport function loadSignerType() {\n  return storage.getItem(SIGNER_TYPE_KEY);\n}\nexport function storeSignerType(signerType) {\n  storage.setItem(SIGNER_TYPE_KEY, signerType);\n}\nexport function signerToSignerType(signer) {\n  if (!signer) {\n    return undefined;\n  }\n  return signer instanceof SCWSigner ? 'scw' : 'walletlink';\n}\nexport async function fetchSignerType(params) {\n  const {\n    communicator,\n    metadata,\n    handshakeRequest,\n    callback\n  } = params;\n  listenForWalletLinkSessionRequest(communicator, metadata, callback, handshakeRequest).catch(() => {});\n  const request = {\n    id: crypto.randomUUID(),\n    event: 'selectSignerType',\n    data: Object.assign(Object.assign({}, params.preference), {\n      handshakeRequest\n    })\n  };\n  const {\n    data\n  } = await communicator.postRequestAndWaitForResponse(request);\n  return data;\n}\nexport function createSigner(params) {\n  const {\n    signerType,\n    metadata,\n    communicator,\n    callback\n  } = params;\n  switch (signerType) {\n    case 'scw':\n      {\n        return new SCWSigner({\n          metadata,\n          callback,\n          communicator\n        });\n      }\n    case 'walletlink':\n      {\n        return new WalletLinkSigner({\n          metadata,\n          callback\n        });\n      }\n  }\n}\nasync function listenForWalletLinkSessionRequest(communicator, metadata, callback, handshakeRequest) {\n  await communicator.onMessage(({\n    event\n  }) => event === 'WalletLinkSessionRequest');\n  // temporary walletlink signer instance to handle WalletLinkSessionRequest\n  // will revisit this when refactoring the walletlink signer\n  const walletlink = new WalletLinkSigner({\n    metadata,\n    callback\n  });\n  // send wallet link session to popup\n  communicator.postMessage({\n    event: 'WalletLinkUpdate',\n    data: {\n      session: walletlink.getSession()\n    }\n  });\n  // wait for handshake to complete\n  await walletlink.handshake(handshakeRequest);\n  // send connected status to popup\n  communicator.postMessage({\n    event: 'WalletLinkUpdate',\n    data: {\n      connected: true\n    }\n  });\n}","map":{"version":3,"names":["ScopedLocalStorage","SCWSigner","WalletLinkSigner","SIGNER_TYPE_KEY","storage","loadSignerType","getItem","storeSignerType","signerType","setItem","signerToSignerType","signer","undefined","fetchSignerType","params","communicator","metadata","handshakeRequest","callback","listenForWalletLinkSessionRequest","catch","request","id","crypto","randomUUID","event","data","Object","assign","preference","postRequestAndWaitForResponse","createSigner","onMessage","walletlink","postMessage","session","getSession","handshake","connected"],"sources":["../../src/sign/util.ts"],"sourcesContent":[null],"mappings":"AASA,SAASA,kBAAkB,QAAQ,uCAAsC;AAEzE,SAASC,SAAS,QAAQ,oBAAoB;AAC9C,SAASC,gBAAgB,QAAQ,kCAAkC;AAEnE,MAAMC,eAAe,GAAG,YAAY;AACpC,MAAMC,OAAO,GAAG,IAAIJ,kBAAkB,CAAC,QAAQ,EAAE,oBAAoB,CAAC;AAEtE,OAAM,SAAUK,cAAcA,CAAA;EAC5B,OAAOD,OAAO,CAACE,OAAO,CAACH,eAAe,CAAe;AACvD;AAEA,OAAM,SAAUI,eAAeA,CAACC,UAAsB;EACpDJ,OAAO,CAACK,OAAO,CAACN,eAAe,EAAEK,UAAU,CAAC;AAC9C;AAEA,OAAM,SAAUE,kBAAkBA,CAACC,MAAqB;EACtD,IAAI,CAACA,MAAM,EAAE;IACX,OAAOC,SAAS;EAClB;EAEA,OAAOD,MAAM,YAAYV,SAAS,GAAG,KAAK,GAAG,YAAY;AAC3D;AAEA,OAAO,eAAeY,eAAeA,CAACC,MAMrC;EACC,MAAM;IAAEC,YAAY;IAAEC,QAAQ;IAAEC,gBAAgB;IAAEC;EAAQ,CAAE,GAAGJ,MAAM;EACrEK,iCAAiC,CAACJ,YAAY,EAAEC,QAAQ,EAAEE,QAAQ,EAAED,gBAAgB,CAAC,CAACG,KAAK,CACzF,MAAK,CAAE,CAAC,CACT;EAED,MAAMC,OAAO,GAAsC;IACjDC,EAAE,EAAEC,MAAM,CAACC,UAAU,EAAE;IACvBC,KAAK,EAAE,kBAAkB;IACzBC,IAAI,EAAAC,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACCd,MAAM,CAACe,UAAU;MACpBZ;IAAgB;GAEnB;EACD,MAAM;IAAES;EAAI,CAAE,GAAG,MAAMX,YAAY,CAACe,6BAA6B,CAACT,OAAO,CAAC;EAC1E,OAAOK,IAAkB;AAC3B;AAEA,OAAM,SAAUK,YAAYA,CAACjB,MAK5B;EACC,MAAM;IAAEN,UAAU;IAAEQ,QAAQ;IAAED,YAAY;IAAEG;EAAQ,CAAE,GAAGJ,MAAM;EAC/D,QAAQN,UAAU;IAChB,KAAK,KAAK;MAAE;QACV,OAAO,IAAIP,SAAS,CAAC;UACnBe,QAAQ;UACRE,QAAQ;UACRH;SACD,CAAC;MACJ;IACA,KAAK,YAAY;MAAE;QACjB,OAAO,IAAIb,gBAAgB,CAAC;UAC1Bc,QAAQ;UACRE;SACD,CAAC;MACJ;EACF;AACF;AAEA,eAAeC,iCAAiCA,CAC9CJ,YAA0B,EAC1BC,QAAqB,EACrBE,QAA+B,EAC/BD,gBAAkC;EAElC,MAAMF,YAAY,CAACiB,SAAS,CAAgB,CAAC;IAAEP;EAAK,CAAE,KAAKA,KAAK,KAAK,0BAA0B,CAAC;EAEhG;EACA;EACA,MAAMQ,UAAU,GAAG,IAAI/B,gBAAgB,CAAC;IACtCc,QAAQ;IACRE;GACD,CAAC;EAEF;EACAH,YAAY,CAACmB,WAAW,CAAC;IACvBT,KAAK,EAAE,kBAAkB;IACzBC,IAAI,EAAE;MAAES,OAAO,EAAEF,UAAU,CAACG,UAAU;IAAE;GACxB,CAAC;EAEnB;EACA,MAAMH,UAAU,CAACI,SAAS,CAACpB,gBAAgB,CAAC;EAE5C;EACAF,YAAY,CAACmB,WAAW,CAAC;IACvBT,KAAK,EAAE,kBAAkB;IACzBC,IAAI,EAAE;MAAEY,SAAS,EAAE;IAAI;GACP,CAAC;AACrB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}