{"ast":null,"code":"import { PACKAGE_NAME, PACKAGE_VERSION } from '../core/constants.js';\nimport { standardErrors } from '../core/error/errors.js';\nimport { logDialogActionClicked, logDialogShown } from '../core/telemetry/events/dialog.js';\nimport { store } from '../store/store.js';\nimport { initDialog } from '../ui/Dialog/index.js';\nimport { getCrossOriginOpenerPolicy } from './checkCrossOriginOpenerPolicy.js';\nconst POPUP_WIDTH = 420;\nconst POPUP_HEIGHT = 700;\nconst POPUP_BLOCKED_TITLE = '{app} wants to continue in Base Account';\nconst POPUP_BLOCKED_MESSAGE = 'This action requires your permission to open a new window.';\nexport function openPopup(url) {\n  const left = (window.innerWidth - POPUP_WIDTH) / 2 + window.screenX;\n  const top = (window.innerHeight - POPUP_HEIGHT) / 2 + window.screenY;\n  appendAppInfoQueryParams(url);\n  function tryOpenPopup() {\n    const popupId = `wallet_${crypto.randomUUID()}`;\n    const popup = window.open(url, popupId, `width=${POPUP_WIDTH}, height=${POPUP_HEIGHT}, left=${left}, top=${top}`);\n    popup === null || popup === void 0 ? void 0 : popup.focus();\n    if (!popup) {\n      return null;\n    }\n    return popup;\n  }\n  const popup = tryOpenPopup();\n  // If the popup was blocked, show a snackbar with a retry button\n  if (!popup) {\n    return openPopupWithDialog(tryOpenPopup);\n  }\n  return Promise.resolve(popup);\n}\nexport function closePopup(popup) {\n  if (popup && !popup.closed) {\n    popup.close();\n  }\n}\nfunction appendAppInfoQueryParams(url) {\n  const params = {\n    sdkName: PACKAGE_NAME,\n    sdkVersion: PACKAGE_VERSION,\n    origin: window.location.origin,\n    coop: getCrossOriginOpenerPolicy()\n  };\n  for (const [key, value] of Object.entries(params)) {\n    if (!url.searchParams.has(key)) {\n      url.searchParams.append(key, value.toString());\n    }\n  }\n}\nfunction openPopupWithDialog(tryOpenPopup) {\n  var _a, _b;\n  const dappName = (_b = (_a = store.config.get().metadata) === null || _a === void 0 ? void 0 : _a.appName) !== null && _b !== void 0 ? _b : 'App';\n  const dialog = initDialog();\n  return new Promise((resolve, reject) => {\n    logDialogShown({\n      dialogContext: 'popup_blocked'\n    });\n    dialog.presentItem({\n      title: POPUP_BLOCKED_TITLE,\n      message: POPUP_BLOCKED_MESSAGE.replace('{app}', dappName),\n      onClose: () => {\n        logDialogActionClicked({\n          dialogContext: 'popup_blocked',\n          dialogAction: 'cancel'\n        });\n        reject(standardErrors.rpc.internal('Popup window was blocked'));\n      },\n      actionItems: [{\n        text: 'Try again',\n        variant: 'primary',\n        onClick: () => {\n          logDialogActionClicked({\n            dialogContext: 'popup_blocked',\n            dialogAction: 'confirm'\n          });\n          const popup = tryOpenPopup();\n          if (popup) {\n            resolve(popup);\n          } else {\n            reject(standardErrors.rpc.internal('Popup window was blocked'));\n          }\n          dialog.clear();\n        }\n      }, {\n        text: 'Cancel',\n        variant: 'secondary',\n        onClick: () => {\n          logDialogActionClicked({\n            dialogContext: 'popup_blocked',\n            dialogAction: 'cancel'\n          });\n          reject(standardErrors.rpc.internal('Popup window was blocked'));\n          dialog.clear();\n        }\n      }]\n    });\n  });\n}","map":{"version":3,"names":["PACKAGE_NAME","PACKAGE_VERSION","standardErrors","logDialogActionClicked","logDialogShown","store","initDialog","getCrossOriginOpenerPolicy","POPUP_WIDTH","POPUP_HEIGHT","POPUP_BLOCKED_TITLE","POPUP_BLOCKED_MESSAGE","openPopup","url","left","window","innerWidth","screenX","top","innerHeight","screenY","appendAppInfoQueryParams","tryOpenPopup","popupId","crypto","randomUUID","popup","open","focus","openPopupWithDialog","Promise","resolve","closePopup","closed","close","params","sdkName","sdkVersion","origin","location","coop","key","value","Object","entries","searchParams","has","append","toString","dappName","_b","_a","config","get","metadata","appName","dialog","reject","dialogContext","presentItem","title","message","replace","onClose","dialogAction","rpc","internal","actionItems","text","variant","onClick","clear"],"sources":["../../src/util/web.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}