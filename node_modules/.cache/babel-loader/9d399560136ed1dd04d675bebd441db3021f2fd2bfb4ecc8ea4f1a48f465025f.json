{"ast":null,"code":"import { ConstantsUtil } from '@reown/appkit-common';\nimport { AccountController } from '../controllers/AccountController.js';\nimport { ChainController } from '../controllers/ChainController.js';\nimport { ConnectorController } from '../controllers/ConnectorController.js';\nimport { EventsController } from '../controllers/EventsController.js';\nimport { RouterController } from '../controllers/RouterController.js';\nimport { SnackController } from '../controllers/SnackController.js';\nimport { CoreHelperUtil } from './CoreHelperUtil.js';\nimport { StorageUtil } from './StorageUtil.js';\nfunction getPopupWindow() {\n  try {\n    return CoreHelperUtil.returnOpenHref(`${ConstantsUtil.SECURE_SITE_SDK_ORIGIN}/loading`, 'popupWindow', 'width=600,height=800,scrollbars=yes');\n  } catch (error) {\n    throw new Error('Could not open social popup');\n  }\n}\nexport async function connectFarcaster() {\n  RouterController.push('ConnectingFarcaster');\n  const authConnector = ConnectorController.getAuthConnector();\n  if (authConnector) {\n    if (!AccountController.state.farcasterUrl) {\n      try {\n        const {\n          url\n        } = await authConnector.provider.getFarcasterUri();\n        AccountController.setFarcasterUrl(url, ChainController.state.activeChain);\n      } catch (error) {\n        RouterController.goBack();\n        SnackController.showError(error);\n      }\n    }\n  }\n}\nexport async function connectSocial(socialProvider) {\n  RouterController.push('ConnectingSocial');\n  const authConnector = ConnectorController.getAuthConnector();\n  let popupWindow = null;\n  try {\n    const timeout = setTimeout(() => {\n      throw new Error('Social login timed out. Please try again.');\n    }, 45_000);\n    if (authConnector && socialProvider) {\n      if (!CoreHelperUtil.isTelegram()) {\n        popupWindow = getPopupWindow();\n      }\n      if (popupWindow) {\n        AccountController.setSocialWindow(popupWindow, ChainController.state.activeChain);\n      } else if (!CoreHelperUtil.isTelegram()) {\n        throw new Error('Could not create social popup');\n      }\n      const {\n        uri\n      } = await authConnector.provider.getSocialRedirectUri({\n        provider: socialProvider\n      });\n      if (!uri) {\n        popupWindow?.close();\n        throw new Error('Could not fetch the social redirect uri');\n      }\n      if (popupWindow) {\n        popupWindow.location.href = uri;\n      }\n      if (CoreHelperUtil.isTelegram()) {\n        StorageUtil.setTelegramSocialProvider(socialProvider);\n        const parsedUri = CoreHelperUtil.formatTelegramSocialLoginUrl(uri);\n        CoreHelperUtil.openHref(parsedUri, '_top');\n      }\n      clearTimeout(timeout);\n    }\n  } catch (error) {\n    popupWindow?.close();\n    SnackController.showError(error?.message);\n  }\n}\nexport async function executeSocialLogin(socialProvider) {\n  AccountController.setSocialProvider(socialProvider, ChainController.state.activeChain);\n  EventsController.sendEvent({\n    type: 'track',\n    event: 'SOCIAL_LOGIN_STARTED',\n    properties: {\n      provider: socialProvider\n    }\n  });\n  if (socialProvider === 'farcaster') {\n    await connectFarcaster();\n  } else {\n    await connectSocial(socialProvider);\n  }\n}","map":{"version":3,"names":["ConstantsUtil","AccountController","ChainController","ConnectorController","EventsController","RouterController","SnackController","CoreHelperUtil","StorageUtil","getPopupWindow","returnOpenHref","SECURE_SITE_SDK_ORIGIN","error","Error","connectFarcaster","push","authConnector","getAuthConnector","state","farcasterUrl","url","provider","getFarcasterUri","setFarcasterUrl","activeChain","goBack","showError","connectSocial","socialProvider","popupWindow","timeout","setTimeout","isTelegram","setSocialWindow","uri","getSocialRedirectUri","close","location","href","setTelegramSocialProvider","parsedUri","formatTelegramSocialLoginUrl","openHref","clearTimeout","message","executeSocialLogin","setSocialProvider","sendEvent","type","event","properties"],"sources":["../../../../src/utils/SocialsUtil.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}