{"ast":null,"code":"import { standardErrors } from \"../../../core/error/errors.js\";\nimport { getClient } from \"../../../store/chain-clients/utils.js\";\nimport { store } from \"../../../store/store.js\";\nimport { assertPresence } from \"../../../util/assertPresence.js\";\nimport { decodeAbiParameters, encodeFunctionData, numberToHex, toHex } from \"viem\";\nimport { waitForCallsStatus } from \"viem/experimental\";\nimport { abi } from \"../utils/constants.js\";\nimport { findOwnerIndex } from \"../utils/findOwnerIndex.js\";\nimport { presentAddOwnerDialog } from \"./presentAddOwnerDialog.js\";\nexport async function handleAddSubAccountOwner({\n  ownerAccount,\n  globalAccountRequest\n}) {\n  var _a, _b;\n  const account = store.account.get();\n  const subAccount = store.subAccounts.get();\n  const globalAccount = (_a = account.accounts) === null || _a === void 0 ? void 0 : _a.find(account => account.toLowerCase() !== (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address.toLowerCase()));\n  assertPresence(globalAccount, standardErrors.provider.unauthorized(\"no global account\"));\n  assertPresence((_b = account.chain) === null || _b === void 0 ? void 0 : _b.id, standardErrors.provider.unauthorized(\"no chain id\"));\n  assertPresence(subAccount === null || subAccount === void 0 ? void 0 : subAccount.address, standardErrors.provider.unauthorized(\"no sub account\"));\n  const calls = [];\n  if (ownerAccount.type === \"local\" && ownerAccount.address) {\n    calls.push({\n      to: subAccount.address,\n      data: encodeFunctionData({\n        abi,\n        functionName: \"addOwnerAddress\",\n        args: [ownerAccount.address]\n      }),\n      value: toHex(0)\n    });\n  }\n  if (ownerAccount.publicKey) {\n    const [x, y] = decodeAbiParameters([{\n      type: \"bytes32\"\n    }, {\n      type: \"bytes32\"\n    }], ownerAccount.publicKey);\n    calls.push({\n      to: subAccount.address,\n      data: encodeFunctionData({\n        abi,\n        functionName: \"addOwnerPublicKey\",\n        args: [x, y]\n      }),\n      value: toHex(0)\n    });\n  }\n  const request = {\n    method: \"wallet_sendCalls\",\n    params: [{\n      version: \"1\",\n      calls,\n      chainId: numberToHex(84532),\n      from: globalAccount\n    }]\n  };\n  const selection = await presentAddOwnerDialog();\n  if (selection === \"cancel\") {\n    throw standardErrors.provider.unauthorized(\"user cancelled\");\n  }\n  const callsId = await globalAccountRequest(request);\n  const client = getClient(account.chain.id);\n  assertPresence(client, standardErrors.rpc.internal(`client not found for chainId ${account.chain.id}`));\n  const callsResult = await waitForCallsStatus(client, {\n    id: callsId\n  });\n  if (callsResult.status !== 'success') {\n    throw standardErrors.rpc.internal(\"add owner call failed\");\n  }\n  const ownerIndex = await findOwnerIndex({\n    address: subAccount.address,\n    publicKey: ownerAccount.type === \"local\" && ownerAccount.address ? ownerAccount.address : ownerAccount.publicKey,\n    client\n  });\n  if (ownerIndex === -1) {\n    throw standardErrors.rpc.internal(\"failed to find owner index\");\n  }\n  return ownerIndex;\n}","map":{"version":3,"names":["standardErrors","getClient","store","assertPresence","decodeAbiParameters","encodeFunctionData","numberToHex","toHex","waitForCallsStatus","abi","findOwnerIndex","presentAddOwnerDialog","handleAddSubAccountOwner","ownerAccount","globalAccountRequest","account","get","subAccount","subAccounts","globalAccount","_a","accounts","find","toLowerCase","address","provider","unauthorized","_b","chain","id","calls","type","push","to","data","functionName","args","value","publicKey","x","y","request","method","params","version","chainId","from","selection","callsId","client","rpc","internal","callsResult","status","ownerIndex"],"sources":["../../../../src/sign/scw/utils/handleAddSubAccountOwner.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}