{"ast":null,"code":"import { proxy, snapshot } from 'valtio/vanilla';\nimport { subscribeKey as subKey } from 'valtio/vanilla/utils';\nimport { withErrorBoundary } from '../utils/withErrorBoundary.js';\nimport { AccountController } from './AccountController.js';\nimport { ChainController } from './ChainController.js';\nimport { ConnectorController } from './ConnectorController.js';\nimport { ModalController } from './ModalController.js';\nimport { OptionsController } from './OptionsController.js';\n// -- State --------------------------------------------- //\nconst state = proxy({\n  view: 'Connect',\n  history: ['Connect'],\n  transactionStack: []\n});\n// -- Controller ---------------------------------------- //\nconst controller = {\n  state,\n  subscribeKey(key, callback) {\n    return subKey(state, key, callback);\n  },\n  pushTransactionStack(action) {\n    state.transactionStack.push(action);\n  },\n  popTransactionStack(status) {\n    const action = state.transactionStack.pop();\n    if (!action) {\n      return;\n    }\n    const {\n      onSuccess,\n      onError,\n      onCancel\n    } = action;\n    switch (status) {\n      case 'success':\n        onSuccess?.();\n        break;\n      case 'error':\n        onError?.();\n        RouterController.goBack();\n        break;\n      case 'cancel':\n        onCancel?.();\n        RouterController.goBack();\n        break;\n      default:\n    }\n  },\n  push(view, data) {\n    if (view !== state.view) {\n      state.view = view;\n      state.history.push(view);\n      state.data = data;\n    }\n  },\n  reset(view, data) {\n    state.view = view;\n    state.history = [view];\n    state.data = data;\n  },\n  replace(view, data) {\n    const lastView = state.history.at(-1);\n    const isSameView = lastView === view;\n    if (!isSameView) {\n      state.view = view;\n      state.history[state.history.length - 1] = view;\n      state.data = data;\n    }\n  },\n  goBack() {\n    const isConnected = ChainController.state.activeCaipAddress;\n    const isFarcasterView = RouterController.state.view === 'ConnectingFarcaster';\n    const shouldReload = !isConnected && isFarcasterView;\n    if (state.history.length > 1) {\n      state.history.pop();\n      const [last] = state.history.slice(-1);\n      if (last) {\n        const isConnectView = last === 'Connect';\n        if (isConnected && isConnectView) {\n          state.view = 'Account';\n        } else {\n          state.view = last;\n        }\n      }\n    } else {\n      ModalController.close();\n    }\n    if (state.data?.wallet) {\n      state.data.wallet = undefined;\n    }\n    // Reloading the iframe contentwindow and doing the view animation in the modal causes a small freeze in the transition. Doing these separately fixes that.\n    setTimeout(() => {\n      if (shouldReload) {\n        AccountController.setFarcasterUrl(undefined, ChainController.state.activeChain);\n        const authConnector = ConnectorController.getAuthConnector();\n        authConnector?.provider?.reload();\n        const optionsState = snapshot(OptionsController.state);\n        authConnector?.provider?.syncDappData?.({\n          metadata: optionsState.metadata,\n          sdkVersion: optionsState.sdkVersion,\n          projectId: optionsState.projectId,\n          sdkType: optionsState.sdkType\n        });\n      }\n    }, 100);\n  },\n  goBackToIndex(historyIndex) {\n    if (state.history.length > 1) {\n      state.history = state.history.slice(0, historyIndex + 1);\n      const [last] = state.history.slice(-1);\n      if (last) {\n        state.view = last;\n      }\n    }\n  },\n  goBackOrCloseModal() {\n    if (RouterController.state.history.length > 1) {\n      RouterController.goBack();\n    } else {\n      ModalController.close();\n    }\n  }\n};\n// Export the controller wrapped with our error boundary\nexport const RouterController = withErrorBoundary(controller);","map":{"version":3,"names":["proxy","snapshot","subscribeKey","subKey","withErrorBoundary","AccountController","ChainController","ConnectorController","ModalController","OptionsController","state","view","history","transactionStack","controller","key","callback","pushTransactionStack","action","push","popTransactionStack","status","pop","onSuccess","onError","onCancel","RouterController","goBack","data","reset","replace","lastView","at","isSameView","length","isConnected","activeCaipAddress","isFarcasterView","shouldReload","last","slice","isConnectView","close","wallet","undefined","setTimeout","setFarcasterUrl","activeChain","authConnector","getAuthConnector","provider","reload","optionsState","syncDappData","metadata","sdkVersion","projectId","sdkType","goBackToIndex","historyIndex","goBackOrCloseModal"],"sources":["../../../../src/controllers/RouterController.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,KAAK,EAAEC,QAAQ,QAAQ,gBAAgB;AAChD,SAASC,YAAY,IAAIC,MAAM,QAAQ,sBAAsB;AAK7D,SAASC,iBAAiB,QAAQ,+BAA+B;AACjE,SAASC,iBAAiB,QAAQ,wBAAwB;AAC1D,SAASC,eAAe,QAAQ,sBAAsB;AACtD,SAASC,mBAAmB,QAAQ,0BAA0B;AAC9D,SAASC,eAAe,QAAQ,sBAAsB;AACtD,SAASC,iBAAiB,QAAQ,wBAAwB;AA8F1D;AACA,MAAMC,KAAK,GAAGV,KAAK,CAAwB;EACzCW,IAAI,EAAE,SAAS;EACfC,OAAO,EAAE,CAAC,SAAS,CAAC;EACpBC,gBAAgB,EAAE;CACnB,CAAC;AAIF;AACA,MAAMC,UAAU,GAAG;EACjBJ,KAAK;EAELR,YAAYA,CAAqBa,GAAM,EAAEC,QAAmD;IAC1F,OAAOb,MAAM,CAACO,KAAK,EAAEK,GAAG,EAAEC,QAAQ,CAAC;EACrC,CAAC;EAEDC,oBAAoBA,CAACC,MAAyB;IAC5CR,KAAK,CAACG,gBAAgB,CAACM,IAAI,CAACD,MAAM,CAAC;EACrC,CAAC;EAEDE,mBAAmBA,CAACC,MAAsC;IACxD,MAAMH,MAAM,GAAGR,KAAK,CAACG,gBAAgB,CAACS,GAAG,EAAE;IAC3C,IAAI,CAACJ,MAAM,EAAE;MACX;IACF;IACA,MAAM;MAAEK,SAAS;MAAEC,OAAO;MAAEC;IAAQ,CAAE,GAAGP,MAAM;IAE/C,QAAQG,MAAM;MACZ,KAAK,SAAS;QACZE,SAAS,GAAE,CAAE;QACb;MACF,KAAK,OAAO;QACVC,OAAO,GAAE,CAAE;QACXE,gBAAgB,CAACC,MAAM,EAAE;QACzB;MACF,KAAK,QAAQ;QACXF,QAAQ,GAAE,CAAE;QACZC,gBAAgB,CAACC,MAAM,EAAE;QACzB;MACF;IACF;EACF,CAAC;EAEDR,IAAIA,CAACR,IAAmC,EAAEiB,IAAoC;IAC5E,IAAIjB,IAAI,KAAKD,KAAK,CAACC,IAAI,EAAE;MACvBD,KAAK,CAACC,IAAI,GAAGA,IAAI;MACjBD,KAAK,CAACE,OAAO,CAACO,IAAI,CAACR,IAAI,CAAC;MACxBD,KAAK,CAACkB,IAAI,GAAGA,IAAI;IACnB;EACF,CAAC;EAEDC,KAAKA,CAAClB,IAAmC,EAAEiB,IAAoC;IAC7ElB,KAAK,CAACC,IAAI,GAAGA,IAAI;IACjBD,KAAK,CAACE,OAAO,GAAG,CAACD,IAAI,CAAC;IACtBD,KAAK,CAACkB,IAAI,GAAGA,IAAI;EACnB,CAAC;EAEDE,OAAOA,CAACnB,IAAmC,EAAEiB,IAAoC;IAC/E,MAAMG,QAAQ,GAAGrB,KAAK,CAACE,OAAO,CAACoB,EAAE,CAAC,CAAC,CAAC,CAAC;IACrC,MAAMC,UAAU,GAAGF,QAAQ,KAAKpB,IAAI;IAEpC,IAAI,CAACsB,UAAU,EAAE;MACfvB,KAAK,CAACC,IAAI,GAAGA,IAAI;MACjBD,KAAK,CAACE,OAAO,CAACF,KAAK,CAACE,OAAO,CAACsB,MAAM,GAAG,CAAC,CAAC,GAAGvB,IAAI;MAC9CD,KAAK,CAACkB,IAAI,GAAGA,IAAI;IACnB;EACF,CAAC;EAEDD,MAAMA,CAAA;IACJ,MAAMQ,WAAW,GAAG7B,eAAe,CAACI,KAAK,CAAC0B,iBAAiB;IAC3D,MAAMC,eAAe,GAAGX,gBAAgB,CAAChB,KAAK,CAACC,IAAI,KAAK,qBAAqB;IAE7E,MAAM2B,YAAY,GAAG,CAACH,WAAW,IAAIE,eAAe;IAEpD,IAAI3B,KAAK,CAACE,OAAO,CAACsB,MAAM,GAAG,CAAC,EAAE;MAC5BxB,KAAK,CAACE,OAAO,CAACU,GAAG,EAAE;MACnB,MAAM,CAACiB,IAAI,CAAC,GAAG7B,KAAK,CAACE,OAAO,CAAC4B,KAAK,CAAC,CAAC,CAAC,CAAC;MACtC,IAAID,IAAI,EAAE;QACR,MAAME,aAAa,GAAGF,IAAI,KAAK,SAAS;QACxC,IAAIJ,WAAW,IAAIM,aAAa,EAAE;UAChC/B,KAAK,CAACC,IAAI,GAAG,SAAS;QACxB,CAAC,MAAM;UACLD,KAAK,CAACC,IAAI,GAAG4B,IAAI;QACnB;MACF;IACF,CAAC,MAAM;MACL/B,eAAe,CAACkC,KAAK,EAAE;IACzB;IAEA,IAAIhC,KAAK,CAACkB,IAAI,EAAEe,MAAM,EAAE;MACtBjC,KAAK,CAACkB,IAAI,CAACe,MAAM,GAAGC,SAAS;IAC/B;IAEA;IACAC,UAAU,CAAC,MAAK;MACd,IAAIP,YAAY,EAAE;QAChBjC,iBAAiB,CAACyC,eAAe,CAACF,SAAS,EAAEtC,eAAe,CAACI,KAAK,CAACqC,WAAW,CAAC;QAC/E,MAAMC,aAAa,GAAGzC,mBAAmB,CAAC0C,gBAAgB,EAAE;QAC5DD,aAAa,EAAEE,QAAQ,EAAEC,MAAM,EAAE;QAEjC,MAAMC,YAAY,GAAGnD,QAAQ,CAACQ,iBAAiB,CAACC,KAAK,CAAC;QACtDsC,aAAa,EAAEE,QAAQ,EAAEG,YAAY,GAAG;UACtCC,QAAQ,EAAEF,YAAY,CAACE,QAAoB;UAC3CC,UAAU,EAAEH,YAAY,CAACG,UAAU;UACnCC,SAAS,EAAEJ,YAAY,CAACI,SAAS;UACjCC,OAAO,EAAEL,YAAY,CAACK;SACvB,CAAC;MACJ;IACF,CAAC,EAAE,GAAG,CAAC;EACT,CAAC;EAEDC,aAAaA,CAACC,YAAoB;IAChC,IAAIjD,KAAK,CAACE,OAAO,CAACsB,MAAM,GAAG,CAAC,EAAE;MAC5BxB,KAAK,CAACE,OAAO,GAAGF,KAAK,CAACE,OAAO,CAAC4B,KAAK,CAAC,CAAC,EAAEmB,YAAY,GAAG,CAAC,CAAC;MACxD,MAAM,CAACpB,IAAI,CAAC,GAAG7B,KAAK,CAACE,OAAO,CAAC4B,KAAK,CAAC,CAAC,CAAC,CAAC;MACtC,IAAID,IAAI,EAAE;QACR7B,KAAK,CAACC,IAAI,GAAG4B,IAAI;MACnB;IACF;EACF,CAAC;EAEDqB,kBAAkBA,CAAA;IAChB,IAAIlC,gBAAgB,CAAChB,KAAK,CAACE,OAAO,CAACsB,MAAM,GAAG,CAAC,EAAE;MAC7CR,gBAAgB,CAACC,MAAM,EAAE;IAC3B,CAAC,MAAM;MACLnB,eAAe,CAACkC,KAAK,EAAE;IACzB;EACF;CACD;AAED;AACA,OAAO,MAAMhB,gBAAgB,GAAGtB,iBAAiB,CAACU,UAAU,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}