{"ast":null,"code":"import { CB_WALLET_RPC_URL } from '../../core/constants.js';\nimport { hexToNumber, isAddressEqual, numberToHex } from 'viem';\nimport { isActionableHttpRequestError, isViemError, standardErrors } from '../../core/error/errors.js';\nimport { logHandshakeCompleted, logHandshakeError, logHandshakeStarted, logRequestCompleted, logRequestError, logRequestStarted } from '../../core/telemetry/events/scw-signer.js';\nimport { logAddOwnerCompleted, logAddOwnerError, logAddOwnerStarted, logInsufficientBalanceErrorHandlingCompleted, logInsufficientBalanceErrorHandlingError, logInsufficientBalanceErrorHandlingStarted, logSubAccountRequestCompleted, logSubAccountRequestError, logSubAccountRequestStarted } from '../../core/telemetry/events/scw-sub-account.js';\nimport { parseErrorMessageFromAny } from '../../core/telemetry/utils.js';\nimport { ensureIntNumber, hexStringFromNumber } from '../../core/type/util.js';\nimport { createClients, getClient } from '../../store/chain-clients/utils.js';\nimport { correlationIds } from '../../store/correlation-ids/store.js';\nimport { store } from '../../store/store.js';\nimport { assertArrayPresence, assertPresence } from '../../util/assertPresence.js';\nimport { assertSubAccount } from '../../util/assertSubAccount.js';\nimport { decryptContent, encryptContent, exportKeyToHexString, importKeyFromHexString } from '../../util/cipher.js';\nimport { fetchRPCRequest } from '../../util/provider.js';\nimport { getCryptoKeyAccount } from '../../kms/crypto-key/index.js';\nimport { SCWKeyManager } from './SCWKeyManager.js';\nimport { addSenderToRequest, appendWithoutDuplicates, assertFetchPermissionsRequest, assertGetCapabilitiesParams, assertParamsChainId, fillMissingParamsForFetchPermissions, getCachedWalletConnectResponse, getSenderFromRequest, initSubAccountConfig, injectRequestCapabilities, makeDataSuffix, prependWithoutDuplicates, requestHasCapability } from './utils.js';\nimport { createSubAccountSigner } from './utils/createSubAccountSigner.js';\nimport { findOwnerIndex } from './utils/findOwnerIndex.js';\nimport { handleAddSubAccountOwner } from './utils/handleAddSubAccountOwner.js';\nimport { handleInsufficientBalanceError } from './utils/handleInsufficientBalance.js';\nexport class Signer {\n  constructor(params) {\n    var _a, _b, _c, _d;\n    this.communicator = params.communicator;\n    this.callback = params.callback;\n    this.keyManager = new SCWKeyManager();\n    const {\n      account,\n      chains\n    } = store.getState();\n    this.accounts = (_a = account.accounts) !== null && _a !== void 0 ? _a : [];\n    this.chain = (_b = account.chain) !== null && _b !== void 0 ? _b : {\n      id: (_d = (_c = params.metadata.appChainIds) === null || _c === void 0 ? void 0 : _c[0]) !== null && _d !== void 0 ? _d : 1\n    };\n    if (chains) {\n      createClients(chains);\n    }\n  }\n  get isConnected() {\n    return this.accounts.length > 0;\n  }\n  async handshake(args) {\n    var _a, _b, _c;\n    const correlationId = correlationIds.get(args);\n    logHandshakeStarted({\n      method: args.method,\n      correlationId\n    });\n    try {\n      // Open the popup before constructing the request message.\n      // This is to ensure that the popup is not blocked by some browsers (i.e. Safari)\n      await ((_b = (_a = this.communicator).waitForPopupLoaded) === null || _b === void 0 ? void 0 : _b.call(_a));\n      const handshakeMessage = await this.createRequestMessage({\n        handshake: {\n          method: args.method,\n          params: (_c = args.params) !== null && _c !== void 0 ? _c : []\n        }\n      }, correlationId);\n      const response = await this.communicator.postRequestAndWaitForResponse(handshakeMessage);\n      // store peer's public key\n      if ('failure' in response.content) {\n        throw response.content.failure;\n      }\n      const peerPublicKey = await importKeyFromHexString('public', response.sender);\n      await this.keyManager.setPeerPublicKey(peerPublicKey);\n      const decrypted = await this.decryptResponseMessage(response);\n      this.handleResponse(args, decrypted);\n      logHandshakeCompleted({\n        method: args.method,\n        correlationId\n      });\n    } catch (error) {\n      logHandshakeError({\n        method: args.method,\n        correlationId,\n        errorMessage: parseErrorMessageFromAny(error)\n      });\n      throw error;\n    }\n  }\n  async request(request) {\n    const correlationId = correlationIds.get(request);\n    logRequestStarted({\n      method: request.method,\n      correlationId\n    });\n    try {\n      const result = await this._request(request);\n      logRequestCompleted({\n        method: request.method,\n        correlationId\n      });\n      return result;\n    } catch (error) {\n      logRequestError({\n        method: request.method,\n        correlationId,\n        errorMessage: parseErrorMessageFromAny(error)\n      });\n      throw error;\n    }\n  }\n  async _request(request) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n    if (this.accounts.length === 0) {\n      switch (request.method) {\n        case 'wallet_switchEthereumChain':\n          {\n            assertParamsChainId(request.params);\n            this.chain.id = Number(request.params[0].chainId);\n            return;\n          }\n        case 'wallet_connect':\n          {\n            // Wait for the popup to be loaded before making async calls\n            await ((_b = (_a = this.communicator).waitForPopupLoaded) === null || _b === void 0 ? void 0 : _b.call(_a));\n            await initSubAccountConfig();\n            // Check if addSubAccount capability is present and if so, inject the the sub account capabilities\n            let capabilitiesToInject = {};\n            if (requestHasCapability(request, 'addSubAccount')) {\n              capabilitiesToInject = (_d = (_c = store.subAccountsConfig.get()) === null || _c === void 0 ? void 0 : _c.capabilities) !== null && _d !== void 0 ? _d : {};\n            }\n            const modifiedRequest = injectRequestCapabilities(request, capabilitiesToInject);\n            return this.sendRequestToPopup(modifiedRequest);\n          }\n        case 'wallet_sendCalls':\n        case 'wallet_sign':\n          {\n            return this.sendRequestToPopup(request);\n          }\n        default:\n          throw standardErrors.provider.unauthorized();\n      }\n    }\n    if (this.shouldRequestUseSubAccountSigner(request)) {\n      const correlationId = correlationIds.get(request);\n      logSubAccountRequestStarted({\n        method: request.method,\n        correlationId\n      });\n      try {\n        const result = await this.sendRequestToSubAccountSigner(request);\n        logSubAccountRequestCompleted({\n          method: request.method,\n          correlationId\n        });\n        return result;\n      } catch (error) {\n        logSubAccountRequestError({\n          method: request.method,\n          correlationId,\n          errorMessage: parseErrorMessageFromAny(error)\n        });\n        throw error;\n      }\n    }\n    switch (request.method) {\n      case 'eth_requestAccounts':\n      case 'eth_accounts':\n        {\n          const subAccount = store.subAccounts.get();\n          const subAccountsConfig = store.subAccountsConfig.get();\n          if (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address) {\n            // if auto sub accounts are enabled and we have a sub account, we need to return it as a top level account\n            // otherwise, we just append it to the accounts array\n            this.accounts = (subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.enableAutoSubAccounts) ? prependWithoutDuplicates(this.accounts, subAccount.address) : appendWithoutDuplicates(this.accounts, subAccount.address);\n          }\n          (_e = this.callback) === null || _e === void 0 ? void 0 : _e.call(this, 'connect', {\n            chainId: numberToHex(this.chain.id)\n          });\n          return this.accounts;\n        }\n      case 'eth_coinbase':\n        return this.accounts[0];\n      case 'net_version':\n        return this.chain.id;\n      case 'eth_chainId':\n        return numberToHex(this.chain.id);\n      case 'wallet_getCapabilities':\n        return this.handleGetCapabilitiesRequest(request);\n      case 'wallet_switchEthereumChain':\n        return this.handleSwitchChainRequest(request);\n      case 'eth_ecRecover':\n      case 'personal_sign':\n      case 'wallet_sign':\n      case 'personal_ecRecover':\n      case 'eth_signTransaction':\n      case 'eth_sendTransaction':\n      case 'eth_signTypedData_v1':\n      case 'eth_signTypedData_v3':\n      case 'eth_signTypedData_v4':\n      case 'eth_signTypedData':\n      case 'wallet_addEthereumChain':\n      case 'wallet_watchAsset':\n      case 'wallet_sendCalls':\n      case 'wallet_showCallsStatus':\n      case 'wallet_grantPermissions':\n        return this.sendRequestToPopup(request);\n      case 'wallet_connect':\n        {\n          // Return cached wallet connect response if available\n          const cachedResponse = await getCachedWalletConnectResponse();\n          if (cachedResponse) {\n            return cachedResponse;\n          }\n          // Wait for the popup to be loaded before making async calls\n          await ((_g = (_f = this.communicator).waitForPopupLoaded) === null || _g === void 0 ? void 0 : _g.call(_f));\n          await initSubAccountConfig();\n          const subAccountsConfig = store.subAccountsConfig.get();\n          const modifiedRequest = injectRequestCapabilities(request, (_h = subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.capabilities) !== null && _h !== void 0 ? _h : {});\n          const result = await this.sendRequestToPopup(modifiedRequest);\n          (_j = this.callback) === null || _j === void 0 ? void 0 : _j.call(this, 'connect', {\n            chainId: numberToHex(this.chain.id)\n          });\n          return result;\n        }\n      // Sub Account Support\n      case 'wallet_getSubAccounts':\n        {\n          const subAccount = store.subAccounts.get();\n          if (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address) {\n            return {\n              subAccounts: [subAccount]\n            };\n          }\n          if (!this.chain.rpcUrl) {\n            throw standardErrors.rpc.internal('No RPC URL set for chain');\n          }\n          const response = await fetchRPCRequest(request, this.chain.rpcUrl);\n          assertArrayPresence(response.subAccounts, 'subAccounts');\n          if (response.subAccounts.length > 0) {\n            // cache the sub account\n            assertSubAccount(response.subAccounts[0]);\n            const subAccount = response.subAccounts[0];\n            store.subAccounts.set({\n              address: subAccount.address,\n              factory: subAccount.factory,\n              factoryData: subAccount.factoryData\n            });\n          }\n          return response;\n        }\n      case 'wallet_addSubAccount':\n        return this.addSubAccount(request);\n      case 'coinbase_fetchPermissions':\n        {\n          assertFetchPermissionsRequest(request);\n          const completeRequest = fillMissingParamsForFetchPermissions(request);\n          const permissions = await fetchRPCRequest(completeRequest, CB_WALLET_RPC_URL);\n          const requestedChainId = hexToNumber((_k = completeRequest.params) === null || _k === void 0 ? void 0 : _k[0].chainId);\n          store.spendPermissions.set(permissions.permissions.map(permission => Object.assign(Object.assign({}, permission), {\n            chainId: requestedChainId\n          })));\n          return permissions;\n        }\n      default:\n        if (!this.chain.rpcUrl) {\n          throw standardErrors.rpc.internal('No RPC URL set for chain');\n        }\n        return fetchRPCRequest(request, this.chain.rpcUrl);\n    }\n  }\n  async sendRequestToPopup(request) {\n    var _a, _b;\n    // Open the popup before constructing the request message.\n    // This is to ensure that the popup is not blocked by some browsers (i.e. Safari)\n    await ((_b = (_a = this.communicator).waitForPopupLoaded) === null || _b === void 0 ? void 0 : _b.call(_a));\n    const response = await this.sendEncryptedRequest(request);\n    const decrypted = await this.decryptResponseMessage(response);\n    return this.handleResponse(request, decrypted);\n  }\n  async handleResponse(request, decrypted) {\n    var _a, _b, _c, _d, _e;\n    const result = decrypted.result;\n    if ('error' in result) throw result.error;\n    switch (request.method) {\n      case 'eth_requestAccounts':\n        {\n          const accounts = result.value;\n          this.accounts = accounts;\n          store.account.set({\n            accounts,\n            chain: this.chain\n          });\n          (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'accountsChanged', accounts);\n          break;\n        }\n      case 'wallet_connect':\n        {\n          const response = result.value;\n          const accounts = response.accounts.map(account => account.address);\n          this.accounts = accounts;\n          store.account.set({\n            accounts\n          });\n          const account = response.accounts.at(0);\n          const capabilities = account === null || account === void 0 ? void 0 : account.capabilities;\n          if (capabilities === null || capabilities === void 0 ? void 0 : capabilities.subAccounts) {\n            const capabilityResponse = capabilities === null || capabilities === void 0 ? void 0 : capabilities.subAccounts;\n            assertArrayPresence(capabilityResponse, 'subAccounts');\n            assertSubAccount(capabilityResponse[0]);\n            store.subAccounts.set({\n              address: capabilityResponse[0].address,\n              factory: capabilityResponse[0].factory,\n              factoryData: capabilityResponse[0].factoryData\n            });\n          }\n          let accounts_ = [this.accounts[0]];\n          const subAccount = store.subAccounts.get();\n          const subAccountsConfig = store.subAccountsConfig.get();\n          if (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address) {\n            // Sub account should be returned as a top level account if auto sub accounts are enabled\n            this.accounts = (subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.enableAutoSubAccounts) ? prependWithoutDuplicates(this.accounts, subAccount.address) : appendWithoutDuplicates(this.accounts, subAccount.address);\n          }\n          const spendPermissions = (_c = (_b = response === null || response === void 0 ? void 0 : response.accounts) === null || _b === void 0 ? void 0 : _b[0].capabilities) === null || _c === void 0 ? void 0 : _c.spendPermissions;\n          if (spendPermissions && 'permissions' in spendPermissions) {\n            store.spendPermissions.set(spendPermissions === null || spendPermissions === void 0 ? void 0 : spendPermissions.permissions);\n          }\n          (_d = this.callback) === null || _d === void 0 ? void 0 : _d.call(this, 'accountsChanged', accounts_);\n          break;\n        }\n      case 'wallet_addSubAccount':\n        {\n          assertSubAccount(result.value);\n          const subAccount = result.value;\n          store.subAccounts.set(subAccount);\n          const subAccountsConfig = store.subAccountsConfig.get();\n          this.accounts = (subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.enableAutoSubAccounts) ? prependWithoutDuplicates(this.accounts, subAccount.address) : appendWithoutDuplicates(this.accounts, subAccount.address);\n          (_e = this.callback) === null || _e === void 0 ? void 0 : _e.call(this, 'accountsChanged', this.accounts);\n          break;\n        }\n      default:\n        break;\n    }\n    return result.value;\n  }\n  async cleanup() {\n    var _a, _b;\n    const metadata = store.config.get().metadata;\n    await this.keyManager.clear();\n    // clear the store\n    store.account.clear();\n    store.subAccounts.clear();\n    store.spendPermissions.clear();\n    store.chains.clear();\n    // reset the signer\n    this.accounts = [];\n    this.chain = {\n      id: (_b = (_a = metadata === null || metadata === void 0 ? void 0 : metadata.appChainIds) === null || _a === void 0 ? void 0 : _a[0]) !== null && _b !== void 0 ? _b : 1\n    };\n  }\n  /**\n   * @returns `null` if the request was successful.\n   * https://eips.ethereum.org/EIPS/eip-3326#wallet_switchethereumchain\n   */\n  async handleSwitchChainRequest(request) {\n    assertParamsChainId(request.params);\n    const chainId = ensureIntNumber(request.params[0].chainId);\n    const localResult = this.updateChain(chainId);\n    if (localResult) return null;\n    const popupResult = await this.sendRequestToPopup(request);\n    if (popupResult === null) {\n      this.updateChain(chainId);\n    }\n    return popupResult;\n  }\n  async handleGetCapabilitiesRequest(request) {\n    assertGetCapabilitiesParams(request.params);\n    const requestedAccount = request.params[0];\n    const filterChainIds = request.params[1]; // Optional second parameter\n    if (!this.accounts.some(account => isAddressEqual(account, requestedAccount))) {\n      throw standardErrors.provider.unauthorized('no active account found when getting capabilities');\n    }\n    const capabilities = store.getState().account.capabilities;\n    // Return empty object if capabilities is undefined\n    if (!capabilities) {\n      return {};\n    }\n    // If no filter is provided, return all capabilities\n    if (!filterChainIds || filterChainIds.length === 0) {\n      return capabilities;\n    }\n    // Convert filter chain IDs to numbers once for efficient lookup\n    const filterChainNumbers = new Set(filterChainIds.map(chainId => hexToNumber(chainId)));\n    // Filter capabilities\n    const filteredCapabilities = Object.fromEntries(Object.entries(capabilities).filter(([capabilityKey]) => {\n      try {\n        const capabilityChainNumber = hexToNumber(capabilityKey);\n        return filterChainNumbers.has(capabilityChainNumber);\n      } catch (_a) {\n        // If capabilityKey is not a valid hex string, exclude it\n        return false;\n      }\n    }));\n    return filteredCapabilities;\n  }\n  async sendEncryptedRequest(request) {\n    const sharedSecret = await this.keyManager.getSharedSecret();\n    if (!sharedSecret) {\n      throw standardErrors.provider.unauthorized('No shared secret found when encrypting request');\n    }\n    const encrypted = await encryptContent({\n      action: request,\n      chainId: this.chain.id\n    }, sharedSecret);\n    const correlationId = correlationIds.get(request);\n    const message = await this.createRequestMessage({\n      encrypted\n    }, correlationId);\n    return this.communicator.postRequestAndWaitForResponse(message);\n  }\n  async createRequestMessage(content, correlationId) {\n    const publicKey = await exportKeyToHexString('public', await this.keyManager.getOwnPublicKey());\n    return {\n      id: crypto.randomUUID(),\n      correlationId,\n      sender: publicKey,\n      content,\n      timestamp: new Date()\n    };\n  }\n  async decryptResponseMessage(message) {\n    var _a, _b, _c;\n    const content = message.content;\n    // throw protocol level error\n    if ('failure' in content) {\n      throw content.failure;\n    }\n    const sharedSecret = await this.keyManager.getSharedSecret();\n    if (!sharedSecret) {\n      throw standardErrors.provider.unauthorized('Invalid session: no shared secret found when decrypting response');\n    }\n    const response = await decryptContent(content.encrypted, sharedSecret);\n    const availableChains = (_a = response.data) === null || _a === void 0 ? void 0 : _a.chains;\n    if (availableChains) {\n      const nativeCurrencies = (_b = response.data) === null || _b === void 0 ? void 0 : _b.nativeCurrencies;\n      const chains = Object.entries(availableChains).map(([id, rpcUrl]) => {\n        const nativeCurrency = nativeCurrencies === null || nativeCurrencies === void 0 ? void 0 : nativeCurrencies[Number(id)];\n        return Object.assign({\n          id: Number(id),\n          rpcUrl\n        }, nativeCurrency ? {\n          nativeCurrency\n        } : {});\n      });\n      store.chains.set(chains);\n      this.updateChain(this.chain.id, chains);\n      createClients(chains);\n    }\n    const walletCapabilities = (_c = response.data) === null || _c === void 0 ? void 0 : _c.capabilities;\n    if (walletCapabilities) {\n      store.account.set({\n        capabilities: walletCapabilities\n      });\n    }\n    return response;\n  }\n  updateChain(chainId, newAvailableChains) {\n    var _a;\n    const state = store.getState();\n    const chains = newAvailableChains !== null && newAvailableChains !== void 0 ? newAvailableChains : state.chains;\n    const chain = chains === null || chains === void 0 ? void 0 : chains.find(chain => chain.id === chainId);\n    if (!chain) return false;\n    if (chain !== this.chain) {\n      this.chain = chain;\n      store.account.set({\n        chain\n      });\n      (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'chainChanged', hexStringFromNumber(chain.id));\n    }\n    return true;\n  }\n  async addSubAccount(request) {\n    var _a, _b, _c, _d;\n    const state = store.getState();\n    const subAccount = state.subAccount;\n    const subAccountsConfig = store.subAccountsConfig.get();\n    if (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address) {\n      this.accounts = (subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.enableAutoSubAccounts) ? prependWithoutDuplicates(this.accounts, subAccount.address) : appendWithoutDuplicates(this.accounts, subAccount.address);\n      (_a = this.callback) === null || _a === void 0 ? void 0 : _a.call(this, 'accountsChanged', this.accounts);\n      return subAccount;\n    }\n    // Wait for the popup to be loaded before sending the request\n    await ((_c = (_b = this.communicator).waitForPopupLoaded) === null || _c === void 0 ? void 0 : _c.call(_b));\n    if (Array.isArray(request.params) && request.params.length > 0 && request.params[0].account && request.params[0].account.type === 'create') {\n      let keys;\n      if (request.params[0].account.keys && request.params[0].account.keys.length > 0) {\n        keys = request.params[0].account.keys;\n      } else {\n        const config = (_d = store.subAccountsConfig.get()) !== null && _d !== void 0 ? _d : {};\n        const {\n          account: ownerAccount\n        } = config.toOwnerAccount ? await config.toOwnerAccount() : await getCryptoKeyAccount();\n        if (!ownerAccount) {\n          throw standardErrors.provider.unauthorized('could not get subaccount owner account when adding sub account');\n        }\n        keys = [{\n          type: ownerAccount.address ? 'address' : 'webauthn-p256',\n          publicKey: ownerAccount.address || ownerAccount.publicKey\n        }];\n      }\n      request.params[0].account.keys = keys;\n    }\n    const response = await this.sendRequestToPopup(request);\n    assertSubAccount(response);\n    return response;\n  }\n  shouldRequestUseSubAccountSigner(request) {\n    const sender = getSenderFromRequest(request);\n    const subAccount = store.subAccounts.get();\n    if (sender) {\n      return sender.toLowerCase() === (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address.toLowerCase());\n    }\n    return false;\n  }\n  async sendRequestToSubAccountSigner(request) {\n    var _a;\n    const subAccount = store.subAccounts.get();\n    const subAccountsConfig = store.subAccountsConfig.get();\n    const config = store.config.get();\n    assertPresence(subAccount === null || subAccount === void 0 ? void 0 : subAccount.address, standardErrors.provider.unauthorized('no active sub account when sending request to sub account signer'));\n    // Get the owner account from the config\n    const ownerAccount = (subAccountsConfig === null || subAccountsConfig === void 0 ? void 0 : subAccountsConfig.toOwnerAccount) ? await subAccountsConfig.toOwnerAccount() : await getCryptoKeyAccount();\n    assertPresence(ownerAccount === null || ownerAccount === void 0 ? void 0 : ownerAccount.account, standardErrors.provider.unauthorized('no active sub account owner when sending request to sub account signer'));\n    const sender = getSenderFromRequest(request);\n    // if sender is undefined, we inject the active sub account\n    // address into the params for the supported request methods\n    if (sender === undefined) {\n      request = addSenderToRequest(request, subAccount.address);\n    }\n    const client = getClient(this.chain.id);\n    assertPresence(client, standardErrors.rpc.internal(`client not found for chainId ${this.chain.id} when sending request to sub account signer`));\n    const globalAccountAddress = this.accounts.find(account => account.toLowerCase() !== subAccount.address.toLowerCase());\n    assertPresence(globalAccountAddress, standardErrors.provider.unauthorized('no global account found when sending request to sub account signer'));\n    const dataSuffix = makeDataSuffix({\n      attribution: (_a = config.preference) === null || _a === void 0 ? void 0 : _a.attribution,\n      dappOrigin: window.location.origin\n    });\n    const publicKey = ownerAccount.account.type === 'local' ? ownerAccount.account.address : ownerAccount.account.publicKey;\n    let ownerIndex = await findOwnerIndex({\n      address: subAccount.address,\n      factory: subAccount.factory,\n      factoryData: subAccount.factoryData,\n      publicKey,\n      client\n    });\n    if (ownerIndex === -1) {\n      const correlationId = correlationIds.get(request);\n      logAddOwnerStarted({\n        method: request.method,\n        correlationId\n      });\n      try {\n        ownerIndex = await handleAddSubAccountOwner({\n          ownerAccount: ownerAccount.account,\n          globalAccountRequest: this.sendRequestToPopup.bind(this)\n        });\n        logAddOwnerCompleted({\n          method: request.method,\n          correlationId\n        });\n      } catch (error) {\n        logAddOwnerError({\n          method: request.method,\n          correlationId,\n          errorMessage: parseErrorMessageFromAny(error)\n        });\n        return standardErrors.provider.unauthorized('failed to add sub account owner when sending request to sub account signer');\n      }\n    }\n    const {\n      request: subAccountRequest\n    } = await createSubAccountSigner({\n      address: subAccount.address,\n      owner: ownerAccount.account,\n      client: client,\n      factory: subAccount.factory,\n      factoryData: subAccount.factoryData,\n      parentAddress: globalAccountAddress,\n      attribution: dataSuffix ? {\n        suffix: dataSuffix\n      } : undefined,\n      ownerIndex\n    });\n    try {\n      const result = await subAccountRequest(request);\n      return result;\n    } catch (error) {\n      let errorObject;\n      if (isViemError(error)) {\n        errorObject = JSON.parse(error.details);\n      } else if (isActionableHttpRequestError(error)) {\n        errorObject = error;\n      } else {\n        throw error;\n      }\n      if (!(isActionableHttpRequestError(errorObject) && errorObject.data)) {\n        throw error;\n      }\n      if (!errorObject.data) {\n        throw error;\n      }\n      const correlationId = correlationIds.get(request);\n      logInsufficientBalanceErrorHandlingStarted({\n        method: request.method,\n        correlationId\n      });\n      try {\n        const result = await handleInsufficientBalanceError({\n          errorData: errorObject.data,\n          globalAccountAddress,\n          subAccountAddress: subAccount.address,\n          client,\n          request,\n          subAccountRequest,\n          globalAccountRequest: this.request.bind(this)\n        });\n        logInsufficientBalanceErrorHandlingCompleted({\n          method: request.method,\n          correlationId\n        });\n        return result;\n      } catch (handlingError) {\n        console.error(handlingError);\n        logInsufficientBalanceErrorHandlingError({\n          method: request.method,\n          correlationId,\n          errorMessage: parseErrorMessageFromAny(handlingError)\n        });\n        throw error;\n      }\n    }\n  }\n}","map":{"version":3,"names":["CB_WALLET_RPC_URL","hexToNumber","isAddressEqual","numberToHex","isActionableHttpRequestError","isViemError","standardErrors","logHandshakeCompleted","logHandshakeError","logHandshakeStarted","logRequestCompleted","logRequestError","logRequestStarted","logAddOwnerCompleted","logAddOwnerError","logAddOwnerStarted","logInsufficientBalanceErrorHandlingCompleted","logInsufficientBalanceErrorHandlingError","logInsufficientBalanceErrorHandlingStarted","logSubAccountRequestCompleted","logSubAccountRequestError","logSubAccountRequestStarted","parseErrorMessageFromAny","ensureIntNumber","hexStringFromNumber","createClients","getClient","correlationIds","store","assertArrayPresence","assertPresence","assertSubAccount","decryptContent","encryptContent","exportKeyToHexString","importKeyFromHexString","fetchRPCRequest","getCryptoKeyAccount","SCWKeyManager","addSenderToRequest","appendWithoutDuplicates","assertFetchPermissionsRequest","assertGetCapabilitiesParams","assertParamsChainId","fillMissingParamsForFetchPermissions","getCachedWalletConnectResponse","getSenderFromRequest","initSubAccountConfig","injectRequestCapabilities","makeDataSuffix","prependWithoutDuplicates","requestHasCapability","createSubAccountSigner","findOwnerIndex","handleAddSubAccountOwner","handleInsufficientBalanceError","Signer","constructor","params","communicator","callback","keyManager","account","chains","getState","accounts","_a","chain","_b","id","_d","_c","metadata","appChainIds","isConnected","length","handshake","args","correlationId","get","method","waitForPopupLoaded","call","handshakeMessage","createRequestMessage","response","postRequestAndWaitForResponse","content","failure","peerPublicKey","sender","setPeerPublicKey","decrypted","decryptResponseMessage","handleResponse","error","errorMessage","request","result","_request","Number","chainId","capabilitiesToInject","subAccountsConfig","capabilities","modifiedRequest","sendRequestToPopup","provider","unauthorized","shouldRequestUseSubAccountSigner","sendRequestToSubAccountSigner","subAccount","subAccounts","address","enableAutoSubAccounts","_e","handleGetCapabilitiesRequest","handleSwitchChainRequest","cachedResponse","_g","_f","_h","_j","rpcUrl","rpc","internal","set","factory","factoryData","addSubAccount","completeRequest","permissions","requestedChainId","_k","spendPermissions","map","permission","Object","assign","sendEncryptedRequest","value","at","capabilityResponse","accounts_","cleanup","config","clear","localResult","updateChain","popupResult","requestedAccount","filterChainIds","some","filterChainNumbers","Set","filteredCapabilities","fromEntries","entries","filter","capabilityKey","capabilityChainNumber","has","sharedSecret","getSharedSecret","encrypted","action","message","publicKey","getOwnPublicKey","crypto","randomUUID","timestamp","Date","availableChains","data","nativeCurrencies","nativeCurrency","walletCapabilities","newAvailableChains","state","find","Array","isArray","type","keys","ownerAccount","toOwnerAccount","toLowerCase","undefined","client","globalAccountAddress","dataSuffix","attribution","preference","dappOrigin","window","location","origin","ownerIndex","globalAccountRequest","bind","subAccountRequest","owner","parentAddress","suffix","errorObject","JSON","parse","details","errorData","subAccountAddress","handlingError","console"],"sources":["../../../src/sign/base-account/Signer.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}