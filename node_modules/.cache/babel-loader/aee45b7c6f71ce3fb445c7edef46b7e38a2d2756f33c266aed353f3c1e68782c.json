{"ast":null,"code":"import { loadTelemetryScript } from '../../../core/telemetry/initCCA.js';\nimport { abi } from '../../../sign/base-account/utils/constants.js';\nimport { store } from '../../../store/store.js';\nimport { assertPresence } from '../../../util/assertPresence.js';\nimport { checkCrossOriginOpenerPolicy } from '../../../util/checkCrossOriginOpenerPolicy.js';\nimport { validatePreferences, validateSubAccount } from '../../../util/validatePreferences.js';\nimport { decodeAbiParameters, encodeFunctionData, toHex } from 'viem';\nimport { BaseAccountProvider } from './BaseAccountProvider.js';\nimport { getInjectedProvider } from './getInjectedProvider.js';\n/**\n * Create Base AccountSDK instance with EIP-1193 compliant provider\n * @param params - Options to create a base account SDK instance.\n * @returns An SDK object with a getProvider method that returns an EIP-1193 compliant provider.\n */\nexport function createBaseAccountSDK(params) {\n  var _a, _b, _c, _d;\n  const options = {\n    metadata: {\n      appName: params.appName || 'App',\n      appLogoUrl: params.appLogoUrl || '',\n      appChainIds: params.appChainIds || []\n    },\n    preference: (_a = params.preference) !== null && _a !== void 0 ? _a : {},\n    paymasterUrls: params.paymasterUrls\n  };\n  //  ====================================================================\n  //  If we have a toOwnerAccount function, set it in the non-persisted config\n  //  ====================================================================\n  if ((_b = params.subAccounts) === null || _b === void 0 ? void 0 : _b.toOwnerAccount) {\n    validateSubAccount(params.subAccounts.toOwnerAccount);\n  }\n  store.subAccountsConfig.set({\n    toOwnerAccount: (_c = params.subAccounts) === null || _c === void 0 ? void 0 : _c.toOwnerAccount,\n    // @ts-expect-error - enableSubAccounts is not officially supported yet\n    enableAutoSubAccounts: (_d = params.subAccounts) === null || _d === void 0 ? void 0 : _d.enableAutoSubAccounts\n  });\n  //  ====================================================================\n  //  Set the options in the store and rehydrate the store from storage\n  //  ====================================================================\n  store.config.set(options);\n  void store.persist.rehydrate();\n  //  ====================================================================\n  //  Validation and telemetry\n  //  ====================================================================\n  void checkCrossOriginOpenerPolicy();\n  validatePreferences(options.preference);\n  if (options.preference.telemetry !== false) {\n    void loadTelemetryScript();\n  }\n  //  ====================================================================\n  //  Return the provider\n  //  ====================================================================\n  let provider = null;\n  const sdk = {\n    getProvider: () => {\n      var _a;\n      if (!provider) {\n        provider = (_a = getInjectedProvider()) !== null && _a !== void 0 ? _a : new BaseAccountProvider(options);\n      }\n      return provider;\n    },\n    subAccount: {\n      async create(account) {\n        var _a, _b;\n        const state = store.getState();\n        assertPresence((_a = state.subAccount) === null || _a === void 0 ? void 0 : _a.address, new Error('subaccount already exists'));\n        return await ((_b = sdk.getProvider()) === null || _b === void 0 ? void 0 : _b.request({\n          method: 'wallet_addSubAccount',\n          params: [{\n            version: '1',\n            account\n          }]\n        }));\n      },\n      async get() {\n        var _a, _b;\n        const subAccount = store.subAccounts.get();\n        if (subAccount === null || subAccount === void 0 ? void 0 : subAccount.address) {\n          return subAccount;\n        }\n        const response = await ((_a = sdk.getProvider()) === null || _a === void 0 ? void 0 : _a.request({\n          method: 'wallet_connect',\n          params: [{\n            version: '1',\n            capabilities: {}\n          }]\n        }));\n        const subAccounts = (_b = response.accounts[0].capabilities) === null || _b === void 0 ? void 0 : _b.subAccounts;\n        if (!Array.isArray(subAccounts)) {\n          return null;\n        }\n        return subAccounts[0];\n      },\n      addOwner: async ({\n        address,\n        publicKey,\n        chainId\n      }) => {\n        var _a, _b;\n        const subAccount = store.subAccounts.get();\n        const account = store.account.get();\n        assertPresence(account, new Error('account does not exist'));\n        assertPresence(subAccount === null || subAccount === void 0 ? void 0 : subAccount.address, new Error('subaccount does not exist'));\n        const calls = [];\n        if (publicKey) {\n          const [x, y] = decodeAbiParameters([{\n            type: 'bytes32'\n          }, {\n            type: 'bytes32'\n          }], publicKey);\n          calls.push({\n            to: subAccount.address,\n            data: encodeFunctionData({\n              abi,\n              functionName: 'addOwnerPublicKey',\n              args: [x, y]\n            }),\n            value: toHex(0)\n          });\n        }\n        if (address) {\n          calls.push({\n            to: subAccount.address,\n            data: encodeFunctionData({\n              abi,\n              functionName: 'addOwnerAddress',\n              args: [address]\n            }),\n            value: toHex(0)\n          });\n        }\n        return await ((_a = sdk.getProvider()) === null || _a === void 0 ? void 0 : _a.request({\n          method: 'wallet_sendCalls',\n          params: [{\n            calls,\n            chainId: toHex(chainId),\n            from: (_b = account.accounts) === null || _b === void 0 ? void 0 : _b[0],\n            version: '1'\n          }]\n        }));\n      },\n      setToOwnerAccount(toSubAccountOwner) {\n        validateSubAccount(toSubAccountOwner);\n        store.subAccountsConfig.set({\n          toOwnerAccount: toSubAccountOwner\n        });\n      }\n    }\n  };\n  return sdk;\n}","map":{"version":3,"names":["loadTelemetryScript","abi","store","assertPresence","checkCrossOriginOpenerPolicy","validatePreferences","validateSubAccount","decodeAbiParameters","encodeFunctionData","toHex","BaseAccountProvider","getInjectedProvider","createBaseAccountSDK","params","options","metadata","appName","appLogoUrl","appChainIds","preference","_a","paymasterUrls","_b","subAccounts","toOwnerAccount","subAccountsConfig","set","_c","enableAutoSubAccounts","_d","config","persist","rehydrate","telemetry","provider","sdk","getProvider","subAccount","create","account","state","getState","address","Error","request","method","version","get","response","capabilities","accounts","Array","isArray","addOwner","publicKey","chainId","calls","x","y","type","push","to","data","functionName","args","value","from","setToOwnerAccount","toSubAccountOwner"],"sources":["../../../../src/interface/builder/core/createBaseAccountSDK.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}