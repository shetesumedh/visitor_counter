{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.prepareAuthorization = prepareAuthorization;\nconst parseAccount_js_1 = require(\"../../accounts/utils/parseAccount.js\");\nconst account_js_1 = require(\"../../errors/account.js\");\nconst isAddressEqual_js_1 = require(\"../../utils/address/isAddressEqual.js\");\nconst getAction_js_1 = require(\"../../utils/getAction.js\");\nconst getChainId_js_1 = require(\"../public/getChainId.js\");\nconst getTransactionCount_js_1 = require(\"../public/getTransactionCount.js\");\nasync function prepareAuthorization(client, parameters) {\n  const {\n    account: account_ = client.account,\n    chainId,\n    nonce\n  } = parameters;\n  if (!account_) throw new account_js_1.AccountNotFoundError({\n    docsPath: '/docs/eip7702/prepareAuthorization'\n  });\n  const account = (0, parseAccount_js_1.parseAccount)(account_);\n  const executor = (() => {\n    if (!parameters.executor) return undefined;\n    if (parameters.executor === 'self') return parameters.executor;\n    return (0, parseAccount_js_1.parseAccount)(parameters.executor);\n  })();\n  const authorization = {\n    address: parameters.contractAddress ?? parameters.address,\n    chainId,\n    nonce\n  };\n  if (typeof authorization.chainId === 'undefined') authorization.chainId = client.chain?.id ?? (await (0, getAction_js_1.getAction)(client, getChainId_js_1.getChainId, 'getChainId')({}));\n  if (typeof authorization.nonce === 'undefined') {\n    authorization.nonce = await (0, getAction_js_1.getAction)(client, getTransactionCount_js_1.getTransactionCount, 'getTransactionCount')({\n      address: account.address,\n      blockTag: 'pending'\n    });\n    if (executor === 'self' || executor?.address && (0, isAddressEqual_js_1.isAddressEqual)(executor.address, account.address)) authorization.nonce += 1;\n  }\n  return authorization;\n}","map":{"version":3,"names":["exports","prepareAuthorization","parseAccount_js_1","require","account_js_1","isAddressEqual_js_1","getAction_js_1","getChainId_js_1","getTransactionCount_js_1","client","parameters","account","account_","chainId","nonce","AccountNotFoundError","docsPath","parseAccount","executor","undefined","authorization","address","contractAddress","chain","id","getAction","getChainId","getTransactionCount","blockTag","isAddressEqual"],"sources":["/home/sumedhshete/visitor-counter/frontend/node_modules/viem/actions/wallet/prepareAuthorization.ts"],"sourcesContent":["import type { Address } from 'abitype'\nimport type { Account } from '../../accounts/types.js'\nimport {\n  type ParseAccountErrorType,\n  parseAccount,\n} from '../../accounts/utils/parseAccount.js'\nimport type { Client } from '../../clients/createClient.js'\nimport type { Transport } from '../../clients/transports/createTransport.js'\nimport {\n  AccountNotFoundError,\n  type AccountNotFoundErrorType,\n} from '../../errors/account.js'\nimport type { ErrorType } from '../../errors/utils.js'\nimport type { GetAccountParameter } from '../../types/account.js'\nimport type {\n  Authorization,\n  AuthorizationRequest,\n} from '../../types/authorization.js'\nimport type { Chain } from '../../types/chain.js'\nimport type { PartialBy } from '../../types/utils.js'\nimport { isAddressEqual } from '../../utils/address/isAddressEqual.js'\nimport type { RequestErrorType } from '../../utils/buildRequest.js'\nimport { getAction } from '../../utils/getAction.js'\nimport { getChainId } from '../public/getChainId.js'\nimport { getTransactionCount } from '../public/getTransactionCount.js'\n\nexport type PrepareAuthorizationParameters<\n  account extends Account | undefined = Account | undefined,\n> = GetAccountParameter<account> &\n  PartialBy<AuthorizationRequest, 'chainId' | 'nonce'> & {\n    /**\n     * Whether the EIP-7702 Transaction will be executed by the EOA (signing this Authorization) or another Account.\n     *\n     * By default, it will be assumed that the EIP-7702 Transaction will\n     * be executed by another Account.\n     */\n    executor?: 'self' | Account | Address | undefined\n  }\n\nexport type PrepareAuthorizationReturnType = Authorization\n\nexport type PrepareAuthorizationErrorType =\n  | ParseAccountErrorType\n  | RequestErrorType\n  | AccountNotFoundErrorType\n  | ErrorType\n\n/**\n * Prepares an [EIP-7702 Authorization](https://eips.ethereum.org/EIPS/eip-7702) object for signing.\n * This Action will fill the required fields of the Authorization object if they are not provided (e.g. `nonce` and `chainId`).\n *\n * With the prepared Authorization object, you can use [`signAuthorization`](https://viem.sh/docs/eip7702/signAuthorization) to sign over the Authorization object.\n *\n * @param client - Client to use\n * @param parameters - {@link PrepareAuthorizationParameters}\n * @returns The prepared Authorization object. {@link PrepareAuthorizationReturnType}\n *\n * @example\n * import { createClient, http } from 'viem'\n * import { privateKeyToAccount } from 'viem/accounts'\n * import { mainnet } from 'viem/chains'\n * import { prepareAuthorization } from 'viem/experimental'\n *\n * const client = createClient({\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const authorization = await prepareAuthorization(client, {\n *   account: privateKeyToAccount('0x..'),\n *   contractAddress: '0xA0Cf798816D4b9b9866b5330EEa46a18382f251e',\n * })\n *\n * @example\n * // Account Hoisting\n * import { createClient, http } from 'viem'\n * import { privateKeyToAccount } from 'viem/accounts'\n * import { mainnet } from 'viem/chains'\n * import { prepareAuthorization } from 'viem/experimental'\n *\n * const client = createClient({\n *   account: privateKeyToAccount('0xâ€¦'),\n *   chain: mainnet,\n *   transport: http(),\n * })\n * const authorization = await prepareAuthorization(client, {\n *   contractAddress: '0xA0Cf798816D4b9b9866b5330EEa46a18382f251e',\n * })\n */\nexport async function prepareAuthorization<\n  chain extends Chain | undefined,\n  account extends Account | undefined,\n>(\n  client: Client<Transport, chain, account>,\n  parameters: PrepareAuthorizationParameters<account>,\n): Promise<PrepareAuthorizationReturnType> {\n  const { account: account_ = client.account, chainId, nonce } = parameters\n\n  if (!account_)\n    throw new AccountNotFoundError({\n      docsPath: '/docs/eip7702/prepareAuthorization',\n    })\n  const account = parseAccount(account_)\n\n  const executor = (() => {\n    if (!parameters.executor) return undefined\n    if (parameters.executor === 'self') return parameters.executor\n    return parseAccount(parameters.executor)\n  })()\n\n  const authorization = {\n    address: parameters.contractAddress ?? parameters.address,\n    chainId,\n    nonce,\n  } as Authorization\n\n  if (typeof authorization.chainId === 'undefined')\n    authorization.chainId =\n      client.chain?.id ??\n      (await getAction(client, getChainId, 'getChainId')({}))\n\n  if (typeof authorization.nonce === 'undefined') {\n    authorization.nonce = await getAction(\n      client,\n      getTransactionCount,\n      'getTransactionCount',\n    )({\n      address: account.address,\n      blockTag: 'pending',\n    })\n    if (\n      executor === 'self' ||\n      (executor?.address && isAddressEqual(executor.address, account.address))\n    )\n      authorization.nonce += 1\n  }\n\n  return authorization\n}\n"],"mappings":";;;;;AAwFAA,OAAA,CAAAC,oBAAA,GAAAA,oBAAA;AAtFA,MAAAC,iBAAA,GAAAC,OAAA;AAMA,MAAAC,YAAA,GAAAD,OAAA;AAYA,MAAAE,mBAAA,GAAAF,OAAA;AAEA,MAAAG,cAAA,GAAAH,OAAA;AACA,MAAAI,eAAA,GAAAJ,OAAA;AACA,MAAAK,wBAAA,GAAAL,OAAA;AAgEO,eAAeF,oBAAoBA,CAIxCQ,MAAyC,EACzCC,UAAmD;EAEnD,MAAM;IAAEC,OAAO,EAAEC,QAAQ,GAAGH,MAAM,CAACE,OAAO;IAAEE,OAAO;IAAEC;EAAK,CAAE,GAAGJ,UAAU;EAEzE,IAAI,CAACE,QAAQ,EACX,MAAM,IAAIR,YAAA,CAAAW,oBAAoB,CAAC;IAC7BC,QAAQ,EAAE;GACX,CAAC;EACJ,MAAML,OAAO,GAAG,IAAAT,iBAAA,CAAAe,YAAY,EAACL,QAAQ,CAAC;EAEtC,MAAMM,QAAQ,GAAG,CAAC,MAAK;IACrB,IAAI,CAACR,UAAU,CAACQ,QAAQ,EAAE,OAAOC,SAAS;IAC1C,IAAIT,UAAU,CAACQ,QAAQ,KAAK,MAAM,EAAE,OAAOR,UAAU,CAACQ,QAAQ;IAC9D,OAAO,IAAAhB,iBAAA,CAAAe,YAAY,EAACP,UAAU,CAACQ,QAAQ,CAAC;EAC1C,CAAC,EAAC,CAAE;EAEJ,MAAME,aAAa,GAAG;IACpBC,OAAO,EAAEX,UAAU,CAACY,eAAe,IAAIZ,UAAU,CAACW,OAAO;IACzDR,OAAO;IACPC;GACgB;EAElB,IAAI,OAAOM,aAAa,CAACP,OAAO,KAAK,WAAW,EAC9CO,aAAa,CAACP,OAAO,GACnBJ,MAAM,CAACc,KAAK,EAAEC,EAAE,KACf,MAAM,IAAAlB,cAAA,CAAAmB,SAAS,EAAChB,MAAM,EAAEF,eAAA,CAAAmB,UAAU,EAAE,YAAY,CAAC,CAAC,EAAE,CAAC,CAAC;EAE3D,IAAI,OAAON,aAAa,CAACN,KAAK,KAAK,WAAW,EAAE;IAC9CM,aAAa,CAACN,KAAK,GAAG,MAAM,IAAAR,cAAA,CAAAmB,SAAS,EACnChB,MAAM,EACND,wBAAA,CAAAmB,mBAAmB,EACnB,qBAAqB,CACtB,CAAC;MACAN,OAAO,EAAEV,OAAO,CAACU,OAAO;MACxBO,QAAQ,EAAE;KACX,CAAC;IACF,IACEV,QAAQ,KAAK,MAAM,IAClBA,QAAQ,EAAEG,OAAO,IAAI,IAAAhB,mBAAA,CAAAwB,cAAc,EAACX,QAAQ,CAACG,OAAO,EAAEV,OAAO,CAACU,OAAO,CAAE,EAExED,aAAa,CAACN,KAAK,IAAI,CAAC;EAC5B;EAEA,OAAOM,aAAa;AACtB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}